WITH counts AS (
    SELECT c.hacker_id, COUNT(*) AS cnt
    FROM Challenges AS c
    GROUP BY c.hacker_id
),
-- How many hackers have each count?
freq AS (
    SELECT cnt, COUNT(*) AS f
    FROM counts
    GROUP BY cnt
),
-- Maximum count (top number of challenges)
maxcnt AS (
    SELECT MAX(cnt) AS max_cnt
    FROM counts
)
SELECT h.hacker_id,
       h.name,
       c.cnt AS total_number_of_challenges
FROM counts AS c
JOIN Hackers AS h
  ON h.hacker_id = c.hacker_id
WHERE
      c.cnt = (SELECT max_cnt FROM maxcnt)          -- keep all at the maximum
   OR c.cnt IN (SELECT cnt FROM freq WHERE f = 1)   -- keep counts that occur once
ORDER BY
    c.cnt DESC,
    h.hacker_id;
